<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />
    <!-- Bootstrap Javascript(jQueryå«ã‚€) -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html,
      body {
        height: 94%;
        margin: 0;
        padding: 0;
      }
      div {
        margin: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div class="col-8">
          <form class="form-inline">
            <div class="form-group">
              <label>å‡ºç™ºåœ°ï¼š </label>
              <input type="text" class="form-control" size="30" id="origin" />
            </div>
            <div class="form-group">
              <label> â†’ã€€ç›®çš„åœ°ï¼š </label>
              <input
                type="text"
                class="form-control"
                size="30"
                id="destination"
              />
            </div>
            <button type="submit" class="btn btn-default" id="search">
              çµŒè·¯æ¢ç´¢
            </button>
          </form>
        </div>
        <div class="col-3">
          <div class="form-inline">
            <div class="form-group">
              <label>ç¨®åˆ¥ï¼š</label>
              <select id="evaluation" name="evaluation" class="form-control">
                <option value="good">ã„ã„ã­ã‡ï½ğŸ‘</option>
                <option value="bad">æ‚ªã„ã­ã‡ï½ğŸ‘</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="map"></div>
    <script>
      // å‚è€ƒã‚µã‚¤ãƒˆï¼šãƒ™ãƒ¼ã‚¹ https://blog.codecamp.jp/googlemaps-api
      // å‚è€ƒã‚µã‚¤ãƒˆï¼šå…¬å¼ https://developers.google.com/maps/documentation/javascript/adding-a-google-map
      // å‚è€ƒã‚µã‚¤ãƒˆï¼šè¤‡æ•°ãƒãƒ¼ã‚«ãƒ¼ï¼ˆå‹•ã‹ãªã„ã‘ã©ã€èª¬æ˜ãŒä¸å¯§ï¼‰ https://www.tam-tam.co.jp/tipsnote/javascript/post7755.html
      // å‚è€ƒã‚µã‚¤ãƒˆï¼šè¤‡æ•°ãƒãƒ¼ã‚«ãƒ¼ https://leben.mobi/blog/google_maps_api_macker/javascript/

      var map;
      var marker = [];
      var infoWindow = [];
      var markerDataGood = [
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ç«‹ã¦ã‚‹å ´æ‰€åãƒ»ç·¯åº¦ãƒ»çµŒåº¦
        {
          name: '<a href="http://google.com">ãã‚Œã„ãªé“</a>',
          lat: 34.365181,
          lng: 132.469987
        },
        {
          name: "è»ŠãŒå°‘ãªã„",
          lat: 34.3665,
          lng: 132.469984
        },
        {
          name: "ã‚¹ãƒˆãƒ¬ã‚¹ãŒãªã„",
          lat: 34.365495,
          lng: 132.469861
        },
        {
          name: "è¦‹é€šã—ãŒè‰¯ã„",
          lat: 34.363843,
          lng: 132.469324
        },
        {
          name: "äººé€šã‚ŠãŒå°‘ãªã„",
          lat: 34.364485,
          lng: 132.4676
        },
        {
          name: "äººé€šã‚ŠãŒå°‘ãªã„",
          lat: 34.365096,
          lng: 132.4677
        }
      ];
      var markerDataBad = [
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ç«‹ã¦ã‚‹å ´æ‰€åãƒ»ç·¯åº¦ãƒ»çµŒåº¦
        {
          name: "é“ãŒç‹­ã„",
          lat: 34.36487,
          lng: 132.468435
        },
        {
          name: "æ€–ã„",
          lat: 34.366731,
          lng: 132.470107
        },
        {
          name: "é“ãŒã‚¬ã‚¿ã‚¬ã‚¿",
          lat: 34.365955,
          lng: 132.468113
        },
        {
          name: "äººé€šã‚ŠãŒå¤šã„",
          lat: 34.365863,
          lng: 132.469463
        },
        {
          name: "è¦‹é€šã—ãŒæ‚ªã„",
          lat: 34.364826,
          lng: 132.46917
        }
      ];

      // ãƒãƒƒãƒ—è¡¨ç¤ºå‡¦ç†
      function initMap() {
        // åœ°å›³ã®ä½œæˆ
        var defaultPosition = new google.maps.LatLng({
          lat: 34.366,
          lng: 132.471
        }); // ã¨ã‚Šã‚ãˆãšæ±ºã‚æ‰“ã¡ãƒ»ãƒ»ãƒ»
        map = new google.maps.Map(document.getElementById("map"), {
          // #sampleã«åœ°å›³ã‚’åŸ‹ã‚è¾¼ã‚€
          center: defaultPosition, // åœ°å›³ã®ä¸­å¿ƒã‚’æŒ‡å®š
          zoom: 18, // åœ°å›³ã®ã‚ºãƒ¼ãƒ ã‚’æŒ‡å®š
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        dispMakers($("[name=evaluation]").val());
      }

      // ãƒãƒ¼ã‚«ãƒ¼ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
      function markerEvent(i) {
        marker[i].addListener("click", function() {
          // ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ã
          infoWindow[i].open(map, marker[i]); // å¹ãå‡ºã—ã®è¡¨ç¤º
        });
      }

      // ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤ºå‡¦ç†ï¼ˆãƒãƒƒãƒ—ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨å‰æï¼‰
      function dispMakers(eval) {
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’åˆæœŸåŒ–ï¼ˆæ—¢ã«ã‚ã‚‹ã‚„ã¤ã‚’å‰Šé™¤ï¼‰
        for (var i = 0; i < marker.length; i++) {
          marker[i].setMap(null);
        }
        // ãƒãƒ¼ã‚«ãƒ¼æ¯ã®å‡¦ç†
        var markerData = getMarkerData(eval);
        for (var i = 0; i < markerData.length; i++) {
          markerLatLng = new google.maps.LatLng({
            lat: markerData[i]["lat"],
            lng: markerData[i]["lng"]
          }); // ç·¯åº¦çµŒåº¦ã®ãƒ‡ãƒ¼ã‚¿ä½œæˆ
          marker[i] = new google.maps.Marker({
            // ãƒãƒ¼ã‚«ãƒ¼ã®è¿½åŠ 
            position: markerLatLng, // ãƒãƒ¼ã‚«ãƒ¼ã‚’ç«‹ã¦ã‚‹ä½ç½®ã‚’æŒ‡å®š
            icon: getMarkerIcon(eval),
            animation: google.maps.Animation.DROP
          });

          infoWindow[i] = new google.maps.InfoWindow({
            // å¹ãå‡ºã—ã®è¿½åŠ 
            content: '<div class="map">' + markerData[i]["name"] + "</div>" // å¹ãå‡ºã—ã«è¡¨ç¤ºã™ã‚‹å†…å®¹
          });

          markerEvent(i); // ãƒãƒ¼ã‚«ãƒ¼ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 

          // ãƒãƒ¼ã‚«ãƒ¼ã‚’è¨­ç½®
          marker[i].setMap(map);
        }
      }

      // è©•ä¾¡ç¨®åˆ¥ã«å¿œã˜ãŸãƒãƒ¼ã‚«ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
      function getMarkerData(eval) {
        if (eval == `good`) {
          return markerDataGood;
        } else {
          return markerDataBad;
        }
      }

      // è©•ä¾¡ç¨®åˆ¥ã«å¿œã˜ãŸãƒãƒ¼ã‚«ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®å–å¾—
      function getMarkerIcon(eval) {
        if (eval == `good`) {
          //return "https://maps.google.com/mapfiles/ms/icons/red-dot.png";
          // return {
          //   path: "M -8,-8 8,8 M 8,-8 -8,8", //åº§æ¨™ï¼ˆÃ—ï¼‰
          //   strokeColor: "#000000", //ç·šã®è‰²
          //   strokeWeight: 4.0, //ç·šã®å¤ªã•
          //   scaledSize: new google.maps.Size(40, 40) //ã‚µã‚¤ã‚º
          // };
          return {
            url:
              //"https://chart.apis.google.com/chart?chst=d_map_spin&chld=0.8|0|ff4500|10|_|good"
              "https://chart.apis.google.com/chart?chst=d_map_pin_letter_withshadow&chld=%E2%80%A2|ff6347"
          };
        } else {
          return {
            url:
              //"https://chart.apis.google.com/chart?chst=d_map_spin&chld=0.8|0|0000ff|10|_|bad"
              "https://chart.apis.google.com/chart?chst=d_map_pin_letter_withshadow&chld=%E2%80%A2|4169e1"
          };
        }
      }

      // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®é¸æŠå¤‰æ›´æ™‚ã®å‡¦ç†
      $("[name=evaluation]").change(function() {
        var val = $("[name=evaluation]").val();

        dispMakers(val);
      });

      // çµŒè·¯é¸æŠãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®å‡¦ç†
      $("#search").on("click", function() {
        initMap();

        // ã¨ã‚Šã‚ãˆãšçµŒè·¯ã¯ã¹ãŸæ›¸ãã§ã™ãƒ»ãƒ»ãƒ»
        var origin = "ç†Šå¹³è£½ä½œæ‰€ ã‚·ãƒ§ãƒ¼ãƒ«ãƒ¼ãƒ ï¼ˆåºƒå³¶ï¼‰";
        var destination = "çœŒç«‹åºƒå³¶ç—…é™¢";

        $("#origin").val(origin);
        $("#destination").val(destination);

        // çµŒè·¯è¡¨ç¤ºç”¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        var DS = new google.maps.DirectionsService();
        var DR = new google.maps.DirectionsRenderer({
          suppressMarkers: true
        });

        //  mapã¨DirectionsServiceã‚’ç´ã¥ã‘ã‚‹
        DR.setMap(map);

        // çµŒè·¯æ¤œç´¢ç”¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆã¹ãŸæ›¸ããƒ»ãƒ»ãƒ»ï¼‰
        var request = {
          origin: origin,
          destination: destination,
          travelMode: google.maps.TravelMode.DRIVING
        };

        // çµŒè·¯è¡¨ç¤ºï¼ˆã¹ãŸæ›¸ããƒ»ãƒ»ãƒ»ï¼‰
        DS.route(request, function(result, status) {
          DR.setDirections(result);
        });
      });
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key="
      async
      defer
    ></script>
  </body>
</html>
